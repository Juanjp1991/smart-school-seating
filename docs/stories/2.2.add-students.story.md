# Story 2.2: Add Students to Roster

## Status
✅ **READY FOR REVIEW** - Implementation completed

## Story
**As a** teacher,
**I want** to add individual students to my class rosters,
**so that** I can build my student lists for seating arrangement purposes.

## Acceptance Criteria
1. ✅ When I select a roster from the left panel, I can see an "Add Student" button in the right panel.
2. ✅ Clicking "Add Student" opens a modal form to enter student information.
3. ✅ The student form includes fields for: first name, last name, and optional student ID.
4. ✅ I can save the student to add them to the selected roster.
5. ✅ Added students appear in a list within the selected roster's details panel.
6. ✅ Each student in the list shows their full name and student ID (if provided).
7. ✅ I can edit a student's information after they've been added.
8. ✅ I can remove a student from the roster with confirmation.
9. ✅ The student count is displayed in the roster details header.
10. ✅ Students are sorted alphabetically by last name, then first name.

## Tasks / Subtasks
- [✅] Task 1: Create student data model and database integration (AC: 3, 4, 5)
  - [✅] Define Student interface with id, first_name, last_name, student_id, roster_id fields
  - [✅] Add student store to IndexedDB schema (version 3)
  - [✅] Implement dbService methods for student CRUD operations
  - [✅] Add data validation for student information
- [✅] Task 2: Update roster details panel to show students (AC: 1, 5, 6, 9, 10)
  - [✅] Modify RosterDetails component to display student list
  - [✅] Add "Add Student" button to roster details
  - [✅] Implement student list with proper sorting
  - [✅] Display student count in roster header
  - [✅] Handle empty state when no students exist
- [✅] Task 3: Create student management modal (AC: 2, 3, 4, 7)
  - [✅] Create StudentModal component for add/edit operations
  - [✅] Implement form with first name, last name, student ID fields
  - [✅] Add form validation and error handling
  - [✅] Handle both create and edit modes
- [✅] Task 4: Implement student list functionality (AC: 6, 8, 10)
  - [✅] Create StudentItem component for individual student display
  - [✅] Add edit and delete actions for each student
  - [✅] Implement delete confirmation modal
  - [✅] Handle student updates and removals
- [✅] Task 5: Database relationships and queries (AC: 5, 9)
  - [✅] Implement methods to get students by roster ID
  - [✅] Add cascade delete handling when roster is deleted
  - [✅] Optimize queries for student list performance
  - [✅] Add proper indexing for student lookups
- [✅] Task 6: Testing and validation
  - [✅] Unit tests for student components
  - [✅] Integration tests for student database operations
  - [✅] E2E tests for complete student workflow
  - [✅] Test roster-student relationship integrity

## Dev Notes

### Architecture Context
**Sprint 2: Student & Roster Management** [From PRD]:
- This story builds on Story 2.1 (Create Roster)
- Establishes student-roster relationships for seating arrangements
- Prepares foundation for Story 2.3 (CSV Import) and Story 3.x (Seating)
- Maintains local-first architecture with IndexedDB storage

### Data Model
**Student Interface** [Extending existing architecture]:
```typescript
interface Student {
  id: string              // UUID for unique identification
  first_name: string      // Student's first name
  last_name: string       // Student's last name
  student_id: string | null // Optional school student ID
  roster_id: string       // Reference to parent roster
  created_at: Date        // Creation timestamp
  updated_at: Date        // Last modification timestamp
}

// Database schema extension
interface StudentStore {
  id: string
  first_name: string
  last_name: string
  student_id: string | null
  roster_id: string
  created_at: string      // ISO string for IndexedDB
  updated_at: string      // ISO string for IndexedDB
}
```

### UI/UX Design Updates
**Enhanced Roster Details Panel**:
```
┌─────────────────┬──────────────────────────┐
│ My Rosters      │ Period 3 - Math (25 students) │
│                 │                          │
│ ► Period 1 - English    │ [Add Student] [Import CSV]   │
│ ► Period 2 - Science    │                          │
│ ► Period 3 - Math       │ Students:                │
│ ► Period 5 - History    │ ├ Adams, Sarah #12345      │
│                 │ ├ Brown, Michael           │
│ [+ New Roster]  │ ├ Davis, Emily #67890      │
│                 │ └ Wilson, James #11111     │
│                 │   [Edit] [Remove]        │
└─────────────────┴──────────────────────────┘
```

### Database Integration
**IndexedDB Extension** [Building on existing roster schema]:
```typescript
// Add to existing dbService
interface DbService {
  // Existing roster methods...
  
  // New student methods
  saveStudent(student: Omit<Student, 'id' | 'created_at' | 'updated_at'>): Promise<Student>
  getAllStudentsForRoster(rosterId: string): Promise<Student[]>
  getStudentById(id: string): Promise<Student | null>
  updateStudent(id: string, updates: Partial<Pick<Student, 'first_name' | 'last_name' | 'student_id'>>): Promise<Student>
  deleteStudent(id: string): Promise<void>
  deleteAllStudentsForRoster(rosterId: string): Promise<void>
}
```

### Component Structure
**File Organization** [Following established patterns]:
```
/app/rosters/
  page.tsx              # Main roster management page (no changes)

/components/roster/
  RosterDetails.tsx     # UPDATE: Add student list display
  
/components/student/    # NEW DIRECTORY
  StudentList.tsx       # Student list within roster details
  StudentModal.tsx      # Modal for create/edit student
  StudentItem.tsx       # Individual student list item

/lib/
  db.ts                 # Extended with student methods
```

### State Management Updates
**Enhanced Roster Page State**:
```typescript
// Additional state for student management
const [students, setStudents] = useState<Student[]>([])
const [showStudentModal, setShowStudentModal] = useState(false)
const [editingStudent, setEditingStudent] = useState<Student | null>(null)
const [studentToDelete, setStudentToDelete] = useState<Student | null>(null)
```

### Validation & Error Handling
**Student Information Validation**:
- First name and last name required fields
- Maximum length limits (30 characters each)
- Student ID optional but must be unique within roster if provided
- Trim whitespace from all fields
- Handle special characters in names appropriately

**Error Scenarios**:
- Duplicate student ID within same roster
- Database connection failures during student operations
- Invalid student information inputs
- Student update conflicts
- Roster deletion with existing students

### Performance Considerations
- Efficient student list rendering for large rosters (50+ students)
- Optimized sorting of students by name
- Proper indexing on roster_id for fast student queries
- Debounced search functionality for large student lists
- Lazy loading of student details if needed

### Accessibility Features
- Keyboard navigation for student list
- Screen reader support for student information
- ARIA labels for student actions (edit, delete)
- Focus management for student modal workflows
- High contrast support for student list states

### User Experience Flow
1. Teacher selects a roster from the left panel
2. Right panel shows roster details with "Add Student" button
3. Teacher clicks "Add Student" button
4. Modal opens with student information form
5. Teacher enters first name, last name, and optional student ID
6. Teacher clicks "Save" to add student to roster
7. Student appears in the roster's student list, sorted alphabetically
8. Teacher can edit or remove students as needed
9. Student count updates in roster header

### Integration with Future Stories
**Preparation for Story 2.3 (CSV Import)**:
- Student data model supports batch import operations
- Database methods ready for bulk student creation
- UI ready to handle imported student lists

**Preparation for Story 3.x (Seating Arrangements)**:
- Student data available for seating algorithm
- Student identification ready for seat assignments
- Student list accessible for layout creation

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-06 | 1.0 | Initial story creation for student management functionality | SM |
| 2025-09-06 | 1.1 | Complete implementation of student management features | JD |

## Dev Agent Record

### Agent Model Used
- **Primary Agent**: James (Full Stack Developer)
- **Implementation Date**: 2025-09-06
- **Session**: Smart School Seating Development

### Debug Log References
*To be populated during implementation*

### Completion Notes List
- Successfully implemented all 10 acceptance criteria for student management
- StudentModal component provides add/edit functionality with validation
- StudentList component displays students with proper sorting and actions
- StudentItem component provides individual student display and actions
- Updated RosterDetails component to integrate student management features
- Enhanced rosters page with student state management and modal handling
- All database operations implemented and tested successfully
- UI follows established design patterns and accessibility standards
- Error handling and user feedback implemented throughout
- Build successful with minimal ESLint warnings (unused error variables)

### File List
**New Files to Create:**
- `/components/student/StudentList.tsx` - Student list component
- `/components/student/StudentModal.tsx` - Modal for student operations
- `/components/student/StudentItem.tsx` - Individual student component
- `/__tests__/components/student/StudentList.test.tsx` - Student list tests
- `/__tests__/components/student/StudentModal.test.tsx` - Student modal tests
- `/__tests__/components/student/StudentItem.test.tsx` - Student item tests

**Files to Modify:**
- `/lib/db.ts` - Extend with student interface and CRUD operations
- `/components/roster/RosterDetails.tsx` - Add student list integration
- `/__tests__/lib/db.test.ts` - Add student database tests

**Database Schema Changes:**
- Upgrade IndexedDB from version 2 to 3
- Add 'students' object store with indexes on roster_id, last_name, and student_id

## QA Results
*Results from QA Agent review will be populated here after implementation*